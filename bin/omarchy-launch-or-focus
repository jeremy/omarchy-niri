#!/bin/bash

# Launch or focus on a given command identified by the passed in window-pattern.
# Niri wrapper: replaces hyprctl clients/dispatch with niri msg equivalents.

source "$(dirname "$0")/../lib.sh"

if ! is_niri; then
  exec ~/.local/share/omarchy/bin/omarchy-launch-or-focus "$@"
fi

if (($# == 0)); then
  echo "Usage: omarchy-launch-or-focus [window-pattern] [launch-command]"
  exit 1
fi

WINDOW_PATTERN="$1"
LAUNCH_COMMAND="${2:-"uwsm-app -- $WINDOW_PATTERN"}"

# Find window by app-id or title matching the pattern
WINDOW_ID=$(niri msg -j windows | jq -r --arg p "$WINDOW_PATTERN" \
  '.[] | select((.app_id | test("\\b" + $p + "\\b";"i")) or (.title | test("\\b" + $p + "\\b";"i"))) | .id' | head -n1)

if [[ -n $WINDOW_ID ]]; then
  niri msg action focus-window --id "$WINDOW_ID"
else
  eval exec setsid $LAUNCH_COMMAND
fi
